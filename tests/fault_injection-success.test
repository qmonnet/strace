#!/bin/sh

# Check success injection.

. "${srcdir=.}/fault_injection.sh"

check_injection()
{
	local syscall rval opts

	syscall=chdir
	rval="$1"; shift
	opts="$1"; shift

	run_strace -a12 -e$syscall -efault="$syscall:$opts" "$@" \
		./fault_injection-success "$rval" > "$EXP"
	match_diff "$LOG" "$EXP"
	rm -f "$EXP"
}

check_injection 0 retval=0
check_injection 42 retval=42
